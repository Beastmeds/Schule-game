<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Dodger – Falling Blocks</title>
<style>
html,body{margin:0;background:#040611;color:#eaf2ff;font-family:system-ui;overflow:hidden}
canvas{display:block;margin:auto;background:radial-gradient(circle at top,#0a0f2a,#040611);border-radius:18px;box-shadow:0 0 40px #00e5ff55}
.ui{position:fixed;top:10px;left:10px;z-index:10;font-size:18px}
.touch{position:fixed;bottom:10px;left:0;right:0;display:flex;justify-content:center;gap:30px}
.btn{width:120px;height:60px;border-radius:18px;background:#ffffff10;backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;font-size:32px;user-select:none}
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000000cc}
.panel{background:#080c22;padding:20px;border-radius:16px;text-align:center}
</style>
</head>
<body>

<canvas id="c" width="900" height="520"></canvas>

<div class="ui">
Score: <span id="score">0</span><br>
Level: <span id="level">1</span><br>
Boss Phase: <span id="phase">-</span>
</div>

<div class="touch">
  <div class="btn" id="left">◀</div>
  <div class="btn" id="right">▶</div>
</div>

<div class="overlay" id="gameover">
  <div class="panel">
    <h2>GAME OVER</h2>
    <p>Score: <span id="finalScore"></span></p>
    <button onclick="location.reload()">Restart</button>
  </div>
</div>

<script>
const c=document.getElementById("c");
const ctx=c.getContext("2d");
const W=c.width,H=c.height;

let keys={};
let leftHold=false,rightHold=false;
let score=0,level=1,frameCount=0,gameOver=false;

const player={x:W/2-20,y:H-70,w:40,h:40,speed:6};
let obstacles=[],bullets=[],ghosts=[],boss=null,bossPhase=0;

document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);
document.getElementById("left").ontouchstart=()=>leftHold=true;
document.getElementById("left").ontouchend=()=>leftHold=false;
document.getElementById("right").ontouchstart=()=>rightHold=true;
document.getElementById("right").ontouchend=()=>rightHold=false;

function rect(a,b,c,d,e,f,g,h){return a<e+g&&a+c>e&&b<f+h&&b+d>f;}

/* SOUND */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(freq,d=0.1){const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.frequency.value=freq;o.connect(g);g.connect(audioCtx.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+d);}

/* SIMULIERTE GHOSTS */
for(let i=0;i<4;i++){ghosts.push({x:Math.random()*W,y:H-70,dir:Math.random()<0.5?-1:1});}

/* BOSS SPAWN */
function spawnBoss(){boss={x:W/2-80,y:50,w:160,h:40,hp:400,dir:1};}
spawnBoss();

function update(){
  if(gameOver) return;

  let move=0;
  if(keys["ArrowLeft"]||keys["a"]||leftHold) move=-1;
  if(keys["ArrowRight"]||keys["d"]||rightHold) move=1;
  player.x+=move*player.speed;
  player.x=Math.max(0,Math.min(W-player.w,player.x));

  score+=0.2;
  document.getElementById("score").textContent=Math.floor(score);

  // LEVEL
  if(score>level*500) level++;
  document.getElementById("level").textContent=level;

  // OBSTACLES FALLEND
  if(frameCount%50===0){
    obstacles.push({x:Math.random()*(W-40),y:-40,w:40,h:40,vy:2+level*0.5});
  }
  for(let i=obstacles.length-1;i>=0;i--){
    const o=obstacles[i];
    o.y+=o.vy;
    if(rect(player.x,player.y,player.w,player.h,o.x,o.y,o.w,o.h)) end();
    if(o.y>H) obstacles.splice(i,1);
  }

  // GHOSTS
  ghosts.forEach(g=>{g.x+=g.dir*2;if(g.x<0||g.x>W-40) g.dir*=-1;});

  // BOSS LOGIK
  if(boss){
    boss.x+=boss.dir*3;
    if(boss.x<0||boss.x+boss.w>W) boss.dir*=-1;

    if(boss.hp>300) bossPhase=1;
    else if(boss.hp>200) bossPhase=2;
    else if(boss.hp>100) bossPhase=3;
    else bossPhase=4;
    document.getElementById("phase").textContent=bossPhase;

    if(Math.random()<0.05){
      const count=bossPhase*2;
      for(let i=0;i<count;i++){
        const angle=(Math.PI*2/count)*i;
        bullets.push({x:boss.x+boss.w/2,y:boss.y+boss.h,vx:Math.cos(angle)*(bossPhase+2),vy:Math.sin(angle)*(bossPhase+2)});
      }
      beep(120);
    }

    if(rect(player.x,player.y,player.w,player.h,boss.x,boss.y,boss.w,boss.h)) end();
    boss.hp-=0.3;
    if(boss.hp<=0){boss=null;score+=1000;}
  }

  // BULLETS
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];b.x+=b.vx;b.y+=b.vy;
    if(rect(player.x,player.y,player.w,player.h,b.x-4,b.y-4,8,8)) end();
    if(b.x<0||b.x>W||b.y<0||b.y>H) bullets.splice(i,1);
  }

  frameCount++;
}

function draw(){
  ctx.clearRect(0,0,W,H);

  // PLAYER
  ctx.fillStyle="#00e5ff";ctx.shadowColor="#00e5ff";ctx.shadowBlur=20;ctx.fillRect(player.x,player.y,player.w,player.h);ctx.shadowBlur=0;

  // GHOSTS
  ctx.globalAlpha=0.4;ctx.fillStyle="#ffffff";ghosts.forEach(g=>ctx.fillRect(g.x,g.y,40,40));ctx.globalAlpha=1;

  // OBSTACLES
  ctx.fillStyle="#ff3b3b";ctx.shadowColor="#ff3b3b";ctx.shadowBlur=20;obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));ctx.shadowBlur=0;

  // BOSS
  if(boss){ctx.fillStyle="#ff4de0";ctx.shadowColor="#ff4de0";ctx.shadowBlur=30;ctx.fillRect(boss.x,boss.y,boss.w,boss.h);ctx.shadowBlur=0;ctx.fillStyle="#fff";ctx.fillRect(boss.x,boss.y-6,(boss.hp/400)*boss.w,4);}

  // BULLETS
  ctx.fillStyle="#ff3b3b";bullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill();});
}

function end(){if(gameOver) return;gameOver=true;beep(60,0.5);document.getElementById("finalScore").textContent=Math.floor(score);document.getElementById("gameover").style.display="flex";}

function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
